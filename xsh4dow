lib = loadstring(game:HttpGet"https://raw.githubusercontent.com/TexaThebardo/LTS/refs/heads/main/Cheats")()
local win = lib:CreateWindow("(â—) LTS X SH4DOW        Version: v3.9 Â¡Update! ", Vector2.new(370, 400), Enum.KeyCode.F1)
local tab1 = win:CreateTab("âš”ï¸ Combat")
local tab2 = win:CreateTab("ğŸ‘ï¸ Visual")
local tab3 = win:CreateTab("ğŸ® Player") -- NUEVO TAB 3
local sector1 = tab1:CreateSector("Camlock Category","left")
local sector10 = tab1:CreateSector("Fov Category","right")
local sector15 = tab2:CreateSector("ESP Category","left")
local sector16 = tab2:CreateSector("ESP V2 Category","right")
local sector20 = tab3:CreateSector("Auto Marshmallow", "left") -- Sector con nÃºmero automÃ¡tico
local sector21 = tab3:CreateSector("Character", "right")

getgenv().OldAimPart = "HumanoidRootPart"
getgenv().AimPart = "Head" -- For R15 Games: {UpperTorso, LowerTorso, HumanoidRootPart, Head} | For R6 Games: {Head, Torso, HumanoidRootPart}
getgenv().AimlockKey = "b"
getgenv().AimRadius = 50 -- How far away from someones character you want to lock on at
getgenv().ThirdPerson = true
getgenv().FirstPerson = true
getgenv().TeamCheck = false -- Check if Target is on your Team (True means it wont lock onto your teamates, false is vice versa) (Set it to false if there are no teams)
getgenv().PredictMovement = true -- Predicts if they are moving in fast velocity (like jumping) so the aimbot will go a bit faster to match their speed
getgenv().PredictionVelocity = 16
getgenv().CheckIfJumped = false
getgenv().AutoPrediction = false
getgenv().Smoothness = 0 -- â† NUEVA VARIABLE (0 = sin smooth, cuanto mÃ¡s alto mÃ¡s suave)
getgenv().AliveCheck = false  -- â† Asegura que empiece desactivado aunque el toggle falle

local L_13_, L_14_, L_15_, L_16_ = game:GetService"Players", game:GetService"UserInputService", game:GetService"RunService", game:GetService"StarterGui";
local L_17_, L_18_, L_19_, L_20_, L_21_, L_22_, L_23_ = L_13_.LocalPlayer, L_13_.LocalPlayer:GetMouse(), workspace.CurrentCamera, CFrame.new, Ray.new, Vector3.new, Vector2.new;
local L_24_, L_25_, L_26_ = false, false, false;
local L_27_;
local L_28_;

getgenv().WorldToViewportPoint = function(L_91_arg0)
    return L_19_:WorldToViewportPoint(L_91_arg0)
end
getgenv().WorldToScreenPoint = function(L_92_arg0)
    return L_19_:WorldToScreenPoint(L_19_, L_92_arg0)
end
getgenv().GetObscuringObjects = function(L_93_arg0)
    if L_93_arg0 and L_93_arg0:FindFirstChild(getgenv().AimPart) and L_17_ and L_17_.Character:FindFirstChild("Head") then
        local L_94_ = workspace:FindPartOnRay(L_21_(
                L_93_arg0[getgenv().AimPart].Position, L_17_.Character.Head.Position)
        )
        if L_94_ then
            return L_94_:IsDescendantOf(L_93_arg0)
        end
    end
end

getgenv().GetNearestTarget = function()
    local L_95_ = {}
    local L_96_ = {}
    local L_97_ = {}
    for L_99_forvar0, L_100_forvar1 in pairs(L_13_:GetPlayers()) do
        if L_100_forvar1 ~= L_17_ then
            table.insert(L_95_, L_100_forvar1)
        end
    end
    for L_101_forvar0, L_102_forvar1 in pairs(L_95_) do
        if L_102_forvar1.Character ~= nil then
            local L_103_ = L_102_forvar1.Character:FindFirstChild("Head")
            if getgenv().TeamCheck == true and L_102_forvar1.Team ~= L_17_.Team then
                local L_104_ = (L_102_forvar1.Character:FindFirstChild("Head").Position - game.Workspace.CurrentCamera.CFrame.p).magnitude
                local L_105_ = Ray.new(game.Workspace.CurrentCamera.CFrame.p, (L_18_.Hit.p - game.Workspace.CurrentCamera.CFrame.p).unit * L_104_)
                local L_106_, L_107_ = game.Workspace:FindPartOnRay(L_105_, game.Workspace)
                local L_108_ = math.floor((L_107_ - L_103_.Position).magnitude)
                L_96_[L_102_forvar1.Name .. L_101_forvar0] = {}
                L_96_[L_102_forvar1.Name .. L_101_forvar0].dist = L_104_
                L_96_[L_102_forvar1.Name .. L_101_forvar0].plr = L_102_forvar1
                L_96_[L_102_forvar1.Name .. L_101_forvar0].diff = L_108_
                table.insert(L_97_, L_108_)
            elseif getgenv().TeamCheck == false and L_102_forvar1.Team == L_17_.Team then
                local L_109_ = (L_102_forvar1.Character:FindFirstChild("Head").Position - game.Workspace.CurrentCamera.CFrame.p).magnitude
                local L_110_ = Ray.new(game.Workspace.CurrentCamera.CFrame.p, (L_18_.Hit.p - game.Workspace.CurrentCamera.CFrame.p).unit * L_109_)
                local L_111_, L_112_ = game.Workspace:FindPartOnRay(L_110_, game.Workspace)
                local L_113_ = math.floor((L_112_ - L_103_.Position).magnitude)
                L_96_[L_102_forvar1.Name .. L_101_forvar0] = {}
                L_96_[L_102_forvar1.Name .. L_101_forvar0].dist = L_109_
                L_96_[L_102_forvar1.Name .. L_101_forvar0].plr = L_102_forvar1
                L_96_[L_102_forvar1.Name .. L_101_forvar0].diff = L_113_
                table.insert(L_97_, L_113_)
            end
        end
    end
    if unpack(L_97_) == nil then
        return nil
    end
    local L_98_ = math.floor(math.min(unpack(L_97_)))
    if L_98_ > getgenv().AimRadius then
        return nil
    end
    for L_114_forvar0, L_115_forvar1 in pairs(L_96_) do
        if L_115_forvar1.diff == L_98_ then
            return L_115_forvar1.plr
        end
    end
    return nil
end

L_18_.KeyDown:Connect(function(L_116_arg0)
    if not (L_14_:GetFocusedTextBox()) then
        if L_116_arg0 == AimlockKey and L_27_ == nil then
            pcall(function()
                if L_25_ ~= true then
                    L_25_ = true
                end
                local L_117_;
                L_117_ = GetNearestTarget()
                if L_117_ ~= nil then
                    L_27_ = L_117_
                end
            end)
        elseif L_116_arg0 == AimlockKey and L_27_ ~= nil then
            if L_27_ ~= nil then
                L_27_ = nil
            end
            if L_25_ ~= false then
                L_25_ = false
            end
        end
    end
end)

L_15_.RenderStepped:Connect(function()
    if getgenv().ThirdPerson == true and getgenv().FirstPerson == true then
        if (L_19_.Focus.p - L_19_.CoordinateFrame.p).Magnitude > 1 or (L_19_.Focus.p - L_19_.CoordinateFrame.p).Magnitude <= 1 then
            L_26_ = true
        else
            L_26_ = false
        end
    elseif getgenv().ThirdPerson == true and getgenv().FirstPerson == false then
        if (L_19_.Focus.p - L_19_.CoordinateFrame.p).Magnitude > 1 then
            L_26_ = true
        else
            L_26_ = false
        end
    elseif getgenv().ThirdPerson == false and getgenv().FirstPerson == true then
        if (L_19_.Focus.p - L_19_.CoordinateFrame.p).Magnitude <= 1 then
            L_26_ = true
        else
            L_26_ = false
        end
    end

    if L_24_ == true and L_25_ == true then

        -- === AÃ‘ADIDO: Alive Check (suelta el target si estÃ¡ muerto) ===
        if getgenv().AliveCheck and L_27_ and L_27_.Character then
            local humanoid = L_27_.Character:FindFirstChild("Humanoid")
            if not humanoid or humanoid.Health <= 0 then
                L_27_ = nil  -- suelta automÃ¡ticamente si estÃ¡ muerto
            end
        end
        -- === FIN Alive Check ===

        if L_27_ and L_27_.Character and L_27_.Character:FindFirstChild(getgenv().AimPart) then
            if getgenv().FirstPerson == true or getgenv().ThirdPerson == true then
                if L_26_ == true then
                    local targetPos = L_27_.Character[getgenv().AimPart].Position
                    if getgenv().PredictMovement == true then
                        targetPos = targetPos + L_27_.Character[getgenv().AimPart].Velocity / getgenv().PredictionVelocity
                    end
                    
                    if getgenv().Smoothness > 0 then
                        L_19_.CFrame = L_19_.CFrame:Lerp(CFrame.new(L_19_.CFrame.p, targetPos), getgenv().Smoothness)
                    else
                        L_19_.CFrame = CFrame.new(L_19_.CFrame.p, targetPos)
                    end
                end
            end
        end
    end

    if CheckIfJumped == true then
        if L_27_ and L_27_.Character and L_27_.Character:FindFirstChild("Humanoid") then
            if L_27_.Character.Humanoid.FloorMaterial == Enum.Material.Air then
                getgenv().AimPart = "RightFoot"
            else
                getgenv().AimPart = getgenv().OldAimPart
            end
        end
    end
end)
sector1:AddToggle("Aimlock - (Key B)",false,function(L_122_arg0)
L_24_ = L_122_arg0
end)
sector1:AddToggle("Team Check",false,function(L_126_arg0)
getgenv().TeamCheck = L_126_arg0
end)
sector1:AddToggle("Alive Check", false, function(state)
    getgenv().AliveCheck = state
end)
sector1:AddToggle("Airshot Function",false,function(L_131_arg0)
CheckIfJumped =  L_131_arg0
end)
sector1:AddToggle("Auto Prediction",false,function(L_132_arg0)
AutoPrediction = L_132_arg0
end)
sector1:AddTextbox("Aimlock Keybind",false,function(L_123_arg0)
AimlockKey = L_123_arg0
end)
sector1:AddTextbox("Aimlock Prediction",false,function(L_124_arg0)
PredictionVelocity = L_124_arg0
end)
sector1:AddTextbox("Aimlock Radius", "", function(value)
    local num = tonumber(value)
    if num and num >= 0 then
        getgenv().AimRadius = num
    end
end)
sector1:AddTextbox("Aim Smoothness", "", function(value)
    local num = tonumber(value)
    if num then
        getgenv().Smoothness = math.clamp(num, 0, 1)
    end
end)
sector1:AddDropdown("Bodypart",{"Head","UpperTorso","HumanoidRootPart", "LowerTorso"},"HumanoidRootPart",false, function(L_125_arg0)
getgenv().AimPart = L_125_arg0
getgenv().OldAimPart = L_125_arg0
end)

local LP = game.Players.LocalPlayer
local Mouse = LP:GetMouse()
local Service = game:GetService("RunService")

circle = Drawing.new("Circle")
circle.Color = Color3.fromRGB(136, 8, 8)
circle.Thickness = 0.1
circle.NumSides = 3500
circle.Radius = 50
circle.Visible = false
circle.Filled = false
circle.Transparency = 0.5

Service.RenderStepped:Connect(function()
	circle.Position = Vector2.new(Mouse.X, Mouse.Y + 35)
end)

sector10:AddToggle("Aimlock Fov", false, function(L_127_arg0)
	circle.Visible = L_127_arg0
end)
sector10:AddToggle("Filled Fov", false, function(L_129_arg0)
	circle.Filled = L_129_arg0
end)
sector10:AddToggle("Square Fov", false, function()
	circle.NumSides = 4
end)
sector10:AddToggle("Circle Fov", false, function()
	circle.NumSides = 350
end)
sector10:AddSlider("Size Fov", 0, 1, 250, 30, function(L_130_arg0)
	circle.Radius = L_130_arg0
end)

-- ==================== MINECRAFT NAME ESP + FEATURE FRIEND (FIXEADO 100% - SIN ELIMINAR NADA) ====================
local ESP_Enabled = false
local ESP_Holders = {}
local CurrentNameColor = Color3.fromRGB(255, 255, 255)
local FriendColor = Color3.fromRGB(0, 255, 100)
local CurrentTextSize = 10
local MinecraftFont = Font.new("rbxasset://fonts/families/SourceSansPro.json")
local FriendsList = {}
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- === FUNCIÃ“N PARA SABER SI ES AMIGO (ORIGINAL) ===
local function IsFriend(plr)
    local name = (plr.DisplayName ~= "" and plr.DisplayName or plr.Name):lower()
    for _, f in FriendsList do
        if f:lower() == name then return true end
    end
    return false
end

-- === CREAR ESP (MEJORADO PERO MANTIENE TU ESTILO) ===
local function CreateESP(plr)
    if plr == LocalPlayer or not plr.Character or not plr.Character:FindFirstChild("Head") then return end
    if ESP_Holders[plr] then ESP_Holders[plr]:Destroy() end

    local bill = Instance.new("BillboardGui")
    bill.Adornee = plr.Character.Head
    bill.Size = UDim2.new(0, 400, 0, 70)
    bill.StudsOffset = Vector3.new(0, 3.0, 0)
    bill.AlwaysOnTop = true
    bill.Parent = plr.Character.Head

    local text = Instance.new("TextLabel")
    text.Size = UDim2.new(1, 0, 1, 0)
    text.BackgroundTransparency = 1
    text.Text = plr.DisplayName ~= "" and plr.DisplayName or plr.Name
    text.FontFace = MinecraftFont
    text.TextStrokeTransparency = 0
    text.TextStrokeColor3 = Color3.new(0, 0, 0)
    text.TextSize = CurrentTextSize
    text.TextScaled = false
    text.TextXAlignment = Enum.TextXAlignment.Center
    text.TextColor3 = IsFriend(plr) and FriendColor or CurrentNameColor
    text.Parent = bill

    ESP_Holders[plr] = bill
end

-- === ACTUALIZAR COLORES Y TAMAÃ‘O (TU FUNCIÃ“N ORIGINAL) ===
local function UpdateESP()
    for plr, bill in pairs(ESP_Holders) do
        if bill and bill:FindFirstChild("TextLabel") then
            local label = bill.TextLabel
            label.TextSize = CurrentTextSize
            label.TextColor3 = IsFriend(plr) and FriendColor or CurrentNameColor
        end
    end
end

-- === LIMPIAR ESP AL SALIR O MORIR ===
local function ClearESP(plr)
    if ESP_Holders[plr] then
        ESP_Holders[plr]:Destroy()
        ESP_Holders[plr] = nil
    end
end

-- ==================================================================
-- === LA CLAVE: EVENTOS QUE ARREGLAN LOS BUGS (sin eliminar nada) ===
-- ==================================================================

-- Cuando un jugador entra al servidor
Players.PlayerAdded:Connect(function(plr)
    if plr == LocalPlayer then return end

    local function onCharacterAdded(char)
        char:WaitForChild("Head", 10)
        task.wait(0.3) -- PequeÃ±o delay por si carga lento
        if ESP_Enabled then
            CreateESP(plr)
        end
    end

    plr.CharacterAdded:Connect(onCharacterAdded)
    if plr.Character then
        onCharacterAdded(plr.Character)
    end
end)

-- Cuando un jugador sale
Players.PlayerRemoving:Connect(function(plr)
    ClearESP(plr)
end)

-- Para jugadores que ya estaban cuando inyectaste el script
for _, plr in ipairs(Players:GetPlayers()) do
    if plr ~= LocalPlayer and plr.Character then
        CreateESP(plr)
    end
    plr.CharacterAdded:Connect(function()
        task.wait(0.3)
        if ESP_Enabled then CreateESP(plr) end
    end)
end

-- ==================================================================
-- === TUS CONTROLES ORIGINALES (100% SIN TOCAR) ===
-- ==================================================================

sector15:AddToggle("ESP Name", false, function(state)
    ESP_Enabled = state
    if not state then
        for _, v in ESP_Holders do if v then v:Destroy() end end
        ESP_Holders = {}
    else
        -- Reactivar para todos los que estÃ¡n ahora
        for _, plr in Players:GetPlayers() do
            if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("Head") then
                CreateESP(plr)
            end
        end
    end
end)

sector15:AddSlider("Size Name", 10, 10, 30, 1, function(v)
    CurrentTextSize = v
    UpdateESP()
end)

sector15:AddColorpicker("Color Normal", CurrentNameColor, function(col)
    CurrentNameColor = col
    UpdateESP()
end)

sector15:AddColorpicker("Friend's Color", FriendColor, function(col)
    FriendColor = col
    UpdateESP()
end)

-- === FEATURE FRIEND (EXACTAMENTE COMO LO TENÃAS) ===
local amigoNombre = ""
sector15:AddTextbox("Friend's Name", "Ej: xSh4dow", function(text)
    amigoNombre = text
end)

sector15:AddButton("Add Friend", function()
    if amigoNombre ~= "" and amigoNombre ~= "Ej: xSh4dow" then
        table.insert(FriendsList, amigoNombre)
        warn("Friend added: " .. amigoNombre)
        UpdateESP()
        amigoNombre = ""
    else
        warn("Invalid name")
    end
end)

sector15:AddButton("Clean Friends", function()
    FriendsList = {}
    warn("Cleaned list")
    UpdateESP()
end)


-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 1. AUTO FARRMEO MARSHMELLOW - SOLO SE ACTIVA CUANDO EL TOGGLE ESTÃ ON
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
getgenv().AutoMarshEnabled = false
getgenv().MarshInterval = 1.42  -- Velocidad fija y segura (380-420 marshmallows/hora)

local Players = game:GetService("Players")
local VIM = game:GetService("VirtualInputManager")
local player = Players.LocalPlayer
local ToolPriority = {"Water", "Sugar Block Bag", "Gelatin", "Empty Bag"}
local currentIndex = 1
local lastPress = 0
local loopRunning = false

local function pressE()
    local r = math.random(40, 85)/1000
    VIM:SendKeyEvent(true, Enum.KeyCode.E, false, game)
    task.wait(r)
    VIM:SendKeyEvent(false, Enum.KeyCode.E, false, game)
end

local function equipNextTool()
    local target = ToolPriority[currentIndex]
    local found = false

    for _, tool in player.Backpack:GetChildren() do
        if tool:IsA("Tool") and string.find(string.lower(tool.Name), string.lower(target)) then
            player.Character.Humanoid:UnequipTools()
            task.wait(0.22)
            player.Character.Humanoid:EquipTool(tool)
            task.wait(0.35)
            found = true
            break
        end
    end

    if not found then
        for _, tool in player.Character:GetChildren() do
            if tool:IsA("Tool") and string.find(string.lower(tool.Name), string.lower(target)) then
                found = true
                break
            end
        end
    end

    currentIndex = currentIndex % #ToolPriority + 1
    return found
end

local function startLoop()
    if loopRunning then return end
    loopRunning = true
    task.spawn(function()
        while getgenv().AutoMarshEnabled do
            if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
                player.CharacterAdded:Wait()
                task.wait(2)
            end

            equipNextTool()

            local waitTime = getgenv().MarshInterval + math.random(-10,15)/100
            while tick() - lastPress < waitTime do task.wait() end

            pressE()
            lastPress = tick()
            task.wait(0.05)
        end
        loopRunning = false
    end)
end

-- === SOLO EL TOGGLE (SIN SLIDER NI BOTÃ“N DE TEST) ===
sector20:AddToggle("Auto Marshmallow", false, function(state)
    getgenv().AutoMarshEnabled = state
    if state then
        currentIndex = 1
        print("AUTO MARSHMALLOW BYPASS ACTIVADO - FARM SIN BAN")
        startLoop()
    else
        print("Auto Marshmallow OFF")
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            player.Character.Humanoid:UnequipTools()
        end
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 1. ESP BOX - SOLO SE ACTIVA CUANDO EL TOGGLE ESTÃ ON
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local ESPBox_Enabled = false
local ESPBox_Thickness = 0.8
local ESPBox_Color = Color3.fromRGB(255, 255, 255)
local ESPBox_Table = {}

local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local function ClearBox(plr)
    if ESPBox_Table[plr] and ESPBox_Table[plr].Box then
        ESPBox_Table[plr].Box:Remove()
        ESPBox_Table[plr] = nil
    end
end

local function CreateBox(plr)
    if plr == LocalPlayer then return end
    ClearBox(plr)

    local Box = Drawing.new("Square")
    Box.Visible = false
    Box.Color = ESPBox_Color
    Box.Thickness = ESPBox_Thickness
    Box.Filled = false
    Box.Transparency = 1

    ESPBox_Table[plr] = { Box = Box }
end

local function UpdateBoxes()
    if not ESPBox_Enabled then return end

    for plr, data in pairs(ESPBox_Table) do
        local Box = data.Box
        local char = plr.Character
        if not char or not char:FindFirstChild("HumanoidRootPart") or not char:FindFirstChild("Humanoid") or char.Humanoid.Health <= 0 then
            Box.Visible = false
            continue
        end

        local root = char.HumanoidRootPart
        local head = char:FindFirstChild("Head")
        if not head then Box.Visible = false continue end

        local rootPos, onScreen = Camera:WorldToViewportPoint(root.Position)
        if not onScreen then Box.Visible = false continue end

        local top = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.7, 0))
        local bottom = Camera:WorldToViewportPoint(root.Position - Vector3.new(0, 4, 0))
        local height = math.clamp(math.abs(top.Y - bottom.Y), 10, 2000)
        local width = height * 0.35  -- Box estrecho y perfecto

        Box.Size = Vector2.new(width, height)
        Box.Position = Vector2.new(rootPos.X - width/2, rootPos.Y - height/2)
        Box.Color = ESPBox_Color
        Box.Thickness = ESPBox_Thickness
        Box.Visible = true
    end
end

-- Jugadores actuales + respawn + nuevos jugadores
for _, plr in Players:GetPlayers() do
    if plr ~= LocalPlayer then
        CreateBox(plr)
        plr.CharacterAdded:Connect(function() task.wait(0.8) CreateBox(plr) end)
    end
end

Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(function() task.wait(0.8) CreateBox(plr) end)
end)

Players.PlayerRemoving:Connect(ClearBox)

RunService.RenderStepped:Connect(UpdateBoxes)

-- AQUÃ ESTÃ LA CLAVE: LO PONEMOS EN sector15 (TAB VISUAL) PARA QUE NO ROMPA NADA
sector15:AddToggle("ESP Box", false, function(state)
    ESPBox_Enabled = state
    if not state then
        for _, v in pairs(ESPBox_Table) do if v.Box then v.Box.Visible = false end end
    end
end)

sector15:AddSlider("Box Thickness", 1, 1, 10, 1, function(v)
    ESPBox_Thickness = v
end)

sector15:AddColorpicker("Box Color", ESPBox_Color, function(c)
    ESPBox_Color = c
end)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 1. ESP HEALTH % - SOLO SE ACTIVA CUANDO EL TOGGLE ESTÃ ON
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Players     = game:GetService("Players")
local RunService  = game:GetService("RunService")
local Camera      = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

local HealthEnabled = false
local HealthTable   = {}
local HealthConnection -- Variable para guardar la conexiÃ³n

local function UpdateHealthESP()
    for plr, h in pairs(HealthTable) do
        if not plr.Parent then continue end
        local char = plr.Character
        if not char or not char:FindFirstChild("Humanoid") or not char:FindFirstChild("Head") or char.Humanoid.Health <= 0 then
            h.Visible = false
            continue
        end
        
        local headPos = Camera:WorldToViewportPoint(char.Head.Position + Vector3.new(0, 0.5, 0))
        if headPos.Z > 0 then
            h.Text = "["..math.floor(char.Humanoid.Health/char.Humanoid.MaxHealth*100).."%]"
            h.Position = Vector2.new(headPos.X, headPos.Y - 50)
            h.Visible = true
        else
            h.Visible = false
        end
    end
end

local function CreateHealth(plr)
    if plr == LocalPlayer or HealthTable[plr] then return end
    local h = Drawing.new("Text")
    h.Size = 16; h.Color = Color3.new(1,1,1); h.Center = true; h.Outline = true; h.Font = 2; h.Visible = false
    HealthTable[plr] = h
end

-- Crear para jugadores existentes
for _, p in Players:GetPlayers() do CreateHealth(p) end
Players.PlayerAdded:Connect(function(p)
    p.CharacterAdded:Connect(function() task.wait(0.9) CreateHealth(p) end)
end)
Players.PlayerRemoving:Connect(function(p)
    if HealthTable[p] then HealthTable[p]:Remove() HealthTable[p] = nil end
end)

-- Toggle que controla la conexiÃ³n completa
sector16:AddToggle("ESP Health %", false, function(state)
    HealthEnabled = state
    
    if state then
        -- Solo conectamos RenderStepped cuando se activa
        if not HealthConnection then
            HealthConnection = RunService.RenderStepped:Connect(UpdateHealthESP)
        end
    else
        -- Desconectamos completamente cuando estÃ¡ off
        if HealthConnection then
            HealthConnection:Disconnect()
            HealthConnection = nil
        end
        -- Ocultamos todo al desactivar
        for _, h in pairs(HealthTable) do h.Visible = false end
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 2. ESP DISTANCE - TAMBIÃ‰N TOTALMENTE DESACTIVADO HASTA EL TOGGLE
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local DistEnabled = false
local DistTable   = {}
local DistConnection

local function UpdateDistESP()
    local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not myRoot then 
        for _, d in pairs(DistTable) do d.Visible = false end
        return 
    end
    
    for plr, d in pairs(DistTable) do
        if not plr.Parent then continue end
        local char = plr.Character
        if not char or not char:FindFirstChild("HumanoidRootPart") then
            d.Visible = false
            continue
        end
        
        local rootPos = Camera:WorldToViewportPoint(char.HumanoidRootPart.Position)
        if rootPos.Z > 0 then
            local dist = math.floor((myRoot.Position - char.HumanoidRootPart.Position).Magnitude)
            d.Text = "["..dist.."m]"
            d.Position = Vector2.new(rootPos.X, rootPos.Y + 10)
            d.Visible = true
        else
            d.Visible = false
        end
    end
end

local function CreateDist(plr)
    if plr == LocalPlayer or DistTable[plr] then return end
    local d = Drawing.new("Text")
    d.Size = 16; d.Color = Color3.new(1,1,1); d.Center = true; d.Outline = true; d.Font = 2; d.Visible = false
    DistTable[plr] = d
end

for _, p in Players:GetPlayers() do CreateDist(p) end
Players.PlayerAdded:Connect(function(p)
    p.CharacterAdded:Connect(function() task.wait(0.9) CreateDist(p) end)
end)
Players.PlayerRemoving:Connect(function(p)
    if DistTable[p] then DistTable[p]:Remove() DistTable[p] = nil end
end)

sector16:AddToggle("ESP Distance", false, function(state)
    DistEnabled = state
    
    if state then
        if not DistConnection then
            DistConnection = RunService.RenderStepped:Connect(UpdateDistESP)
        end
    else
        if DistConnection then
            DistConnection:Disconnect()
            DistConnection = nil
        end
        for _, d in pairs(DistTable) do d.Visible = false end
    end
end)


-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- LOW GRAPHICS + AUTO-DELETE TREE MODELS (sin lag cuando estÃ¡ apagado)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Players     = game:GetService("Players")
local Workspace   = game:GetService("Workspace")
local Settings    = settings()

local LocalPlayer = Players.LocalPlayer

local LowGraphics_Enabled = false
local OriginalQuality = nil
local DescendantConnection = nil

-- Guardar calidad original (solo una vez)
local function SaveOriginalQuality()
    if OriginalQuality then return end
    OriginalQuality = Settings.Rendering.QualityLevel
end

-- FunciÃ³n para aplicar low graphics a un objeto individual
local function ApplyLowToObject(obj)
    if not LowGraphics_Enabled then return end

    task.spawn(function()
        task.wait() -- aseguramos que el objeto estÃ© listo

        -- ELIMINAR ÃRBOLES (Tree, tree, Palm, etc.)
        if obj:IsA("Model") and string.find(string.lower(obj.Name), "tree") then
            obj:Destroy()
            return
        end

        -- BaseParts
        if obj:IsA("BasePart") and (not obj.Parent or obj.Parent.Parent ~= LocalPlayer.Character) then
            obj.Material = Enum.Material.SmoothPlastic
            if obj.Transparency < 0.9 then obj.Transparency = 0 end
            if obj:FindFirstChildOfClass("Decal") then obj:FindFirstChildOfClass("Decal").Transparency = 1 end
            if obj:FindFirstChildOfClass("Texture") then obj:FindFirstChildOfClass("Texture").Transparency = 1 end
        end

        -- Decals & Textures
        if (obj:IsA("Decal") or obj:IsA("Texture")) and (not obj.Parent or obj.Parent.Parent ~= LocalPlayer.Character) then
            obj.Transparency = 1
        end

        -- PartÃ­culas y efectos
        if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Smoke") or obj:IsA("Fire") or obj:IsA("Sparkles") then
            obj.Enabled = false
        end

        -- MeshParts sin textura
        if obj:IsA("MeshPart") and (not obj.Parent or obj.Parent.Parent ~= LocalPlayer.Character) then
            obj.TextureID = ""
        end
    end)
end

-- Activar Low Graphics completo
local function EnableLowGraphics()
    SaveOriginalQuality()
    Settings.Rendering.QualityLevel = 1

    -- Aplicar a todo lo que ya existe
    for _, obj in ipairs(Workspace:GetDescendants()) do
        ApplyLowToObject(obj)
    end

    -- Conectar evento Ãºnico para nuevos objetos (incluye eliminaciÃ³n de Ã¡rboles)
    if not DescendantConnection then
        DescendantConnection = Workspace.DescendantAdded:Connect(function(obj)
            ApplyLowToObject(obj)
        end)
    end
end

-- Desactivar todo perfectamente
local function DisableLowGraphics()
    LowGraphics_Enabled = false

    -- Desconectar el evento (0 lag cuando estÃ¡ apagado)
    if DescendantConnection then
        DescendantConnection:Disconnect()
        DescendantConnection = nil
    end

    -- Restaurar calidad grÃ¡fica
    if OriginalQuality then
        Settings.Rendering.QualityLevel = OriginalQuality
    end

    -- Reactivar partÃ­culas
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Smoke") or obj:IsA("Fire") or obj:IsA("Sparkles") then
            obj.Enabled = true
        end
    end
end

-- TOGGLE PRINCIPAL
sector21:AddToggle("Low Graphics", false, function(state)
    LowGraphics_Enabled = state

    if state then
        EnableLowGraphics()
    else
        DisableLowGraphics()
    end
end)


-- ===================== LTS WATERFALL HUD ROJO MINI â€“ 100% FUNCIONAL =====================

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Stats = game:GetService("Stats")
local MarketplaceService = game:GetService("MarketplaceService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local CoreGui = game:GetService("CoreGui")

-- ELIMINAR HUD VIEJO
for _, gui in pairs(CoreGui:GetChildren()) do
    if gui.Name == "LTSWaterfall_HUD" then gui:Destroy() end
end

-- CREAR HUD
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "LTSWaterfall_HUD"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

local HUD = Instance.new("Frame")
HUD.Size = UDim2.new(0, 240, 0, 40)
HUD.Position = UDim2.new(0.5, -120, 0, -50)
HUD.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
HUD.BackgroundTransparency = 0.15
HUD.BorderSizePixel = 0
HUD.Active = true
HUD.Draggable = true
HUD.Parent = ScreenGui

Instance.new("UICorner", HUD).CornerRadius = UDim.new(0, 8)

local Stroke = Instance.new("UIStroke", HUD)
Stroke.Color = Color3.fromRGB(255, 20, 20)
Stroke.Thickness = 2
Stroke.Transparency = 0.1

-- Avatar
local Avatar = Instance.new("ImageLabel", HUD)
Avatar.Size = UDim2.new(0, 32, 0, 32)
Avatar.Position = UDim2.new(0, 7, 0.5, -16)
Avatar.BackgroundTransparency = 1
pcall(function()
    Avatar.Image = Players:GetUserThumbnailAsync(LocalPlayer.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
end)
Instance.new("UICorner", Avatar).CornerRadius = UDim.new(1, 0)
Instance.new("UIStroke", Avatar).Color = Color3.fromRGB(255, 40, 40)
Instance.new("UIStroke", Avatar).Thickness = 2

-- FunciÃ³n texto
local function T(text, x, y, col, size)
    local lbl = Instance.new("TextLabel", HUD)
    lbl.BackgroundTransparency = 1
    lbl.Position = UDim2.new(0, x, 0, y)
    lbl.Size = UDim2.new(0, 120, 0, size or 11)
    lbl.Text = text
    lbl.TextColor3 = col or Color3.fromRGB(255, 255, 255)
    lbl.Font = Enum.Font.GothamBold
    lbl.TextSize = size or 10
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.TextScaled = false
    return lbl
end

-- Etiquetas
T("Fps:", 48, 6)
T("Ping:", 48, 22)
T("Server:", 132, 6)
T("Name:", 132, 22)

-- Valores iniciales
local FPSLabel = T("60 FPS", 73, 6, Color3.fromRGB(0,255,0), 11)
local PingLabel = T("0 MS", 80, 22, Color3.fromRGB(0,255,0), 11)

-- SERVER: AUTO-SCALED (FIX: TextSize corregido)
local GameName = Instance.new("TextLabel", HUD)
GameName.BackgroundTransparency = 1
GameName.Position = UDim2.new(0, 172, 0, 6)
GameName.Size = UDim2.new(0, 90, 0, 14)
GameName.Font = Enum.Font.GothamBold
GameName.TextColor3 = Color3.fromRGB(255, 100, 100)
GameName.TextXAlignment = Enum.TextXAlignment.Left
GameName.TextSize = 12  -- â† FIX: valor directo
GameName.TextScaled = false
GameName.Text = "Loading..."

-- NAME: USERNAME REAL + AUTO-SCALED (FIX: NameName â†’ NameLabel)
local NameLabel = Instance.new("TextLabel", HUD)
NameLabel.BackgroundTransparency = 1
NameLabel.Position = UDim2.new(0, 172, 0, 22)  -- â† FIX: NameLabel correcto
NameLabel.Size = UDim2.new(0, 90, 0, 14)
NameLabel.Font = Enum.Font.GothamBold
NameLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
NameLabel.TextXAlignment = Enum.TextXAlignment.Left
NameLabel.TextSize = 12
NameLabel.TextScaled = false
NameLabel.Text = LocalPlayer.Name

-- Cargar nombre del servidor/juego
spawn(function()
    pcall(function()
        local info = MarketplaceService:GetProductInfo(game.PlaceId)
        GameName.Text = info.Name or "Unknown Game"
    end)
end)

-- ğŸ”¥ FPS COUNTER COMPLETO (FUNCIONANDO)
local fpsBuffer = {}
local lastTime = tick()
RunService.Heartbeat:Connect(function()
    local now = tick()
    local delta = now - lastTime
    if delta > 0 then
        table.insert(fpsBuffer, 1/delta)
        if #fpsBuffer > 20 then
            table.remove(fpsBuffer, 1)
        end
        local sum = 0
        for _, v in ipairs(fpsBuffer) do
            sum = sum + v
        end
        local avg = math.floor(sum / #fpsBuffer)
        FPSLabel.Text = avg .. " FPS"
        
        -- Color FPS dinÃ¡mico
        if avg >= 90 then
            FPSLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        elseif avg >= 60 then
            FPSLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
        elseif avg >= 40 then
            FPSLabel.TextColor3 = Color3.fromRGB(255, 150, 0)
        else
            FPSLabel.TextColor3 = Color3.fromRGB(255, 30, 30)
        end
    end
    lastTime = now
end)

-- PING + COLOR DINÃMICO
task.spawn(function()
    while task.wait(0.4) do
        pcall(function()
            local ping = math.floor(Stats.Network.ServerStatsItem["Data Ping"]:GetValue())
            PingLabel.Text = ping .. " MS"
            if ping <= 50 then
                PingLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
            elseif ping <= 100 then
                PingLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
            elseif ping <= 150 then
                PingLabel.TextColor3 = Color3.fromRGB(255, 150, 0)
            else
                PingLabel.TextColor3 = Color3.fromRGB(255, 30, 30)
            end
        end)
    end
end)

-- ANIMACIÃ“N DE ENTRADA
TweenService:Create(HUD, TweenInfo.new(0.8, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
    Position = UDim2.new(0.5, -120, 0, 10)
}):Play()

-- ==================== ESP TOOLS SIN FONDO + ROJO SI ARMA PELIGROSA (SLIDER FUNCIONA PERFECTO) ====================
local Players           = game:GetService("Players")
local RunService        = game:GetService("RunService")
local TextService       = game:GetService("TextService")
local LocalPlayer       = Players.LocalPlayer

-- CONFIGURACIÃ“N
local TEXT_SIZE       = 20        -- valor inicial (el slider lo cambia)
local MAX_WIDTH       = 380

local ToolsESP_Enabled = false
local espDrawings = {}  -- [player] = {text = Drawing}

-- TOOLS OCULTOS
local HIDDEN_TOOLS = {
    "empty bag", "potato", "ghost skull face half mask", "black surgical mask", "black surgical", "skimask",
    "flour", "card", "gelatin", "lockpick", "sugar block bag", "crowbar", "water", "fake id", "fist", "phone",
    "standard clip", "speed loader", "extended clip", "heavy magazine", "drum magazine", "lockpick", "crate"
}

-- ARMAS PELIGROSAS â†’ ROJO
local SPECIAL_TOOLS = {
    "prl-16", "arp9", "mpx", "honey badger pistol", "ddm4 v7 pistol", "ar pistol",
    "draco", "tec-9", "mcx", ".308 ar-10", "honey badger", "m&p-15 sport ii",
    "300 blackout", "micro draco", "micro arp", "ak draco", "suppressed mcx",
    "suppressed arp", "whiteout ar9", "fn57", "g19xext", "machete", "springfieldxd mod",
    ".308 ar-10 drum", "honey badger drum", "m&p-15 sport ii drum",
    "micro draco drum", "300 blackout drum", "micro arp drum", "ak draco drum",
    "tan 300 blk mcx", "springfieldxd drum", "mcx drum", "g19xdrum", "tec-9 drum",
    "fn57drum", "arp drum", "taurus drum", "five seven drum", "five-seven drum",
    "plr-16 drum", "g23 drum", "vp9 drum", "p80 drum", "glocks drum", "draco drum",
    "glock 20 drum", "hi-point drum", "g22drum"
}

local hidden  = {}
for _, v in ipairs(HIDDEN_TOOLS)  do hidden[string.lower(v)]  = true end
local special = {}
for _, v in ipairs(SPECIAL_TOOLS) do special[string.lower(v)] = true end

local function createESP(plr)
    if plr == LocalPlayer or espDrawings[plr] then return end
    local txt = Drawing.new("Text")
    txt.Size = TEXT_SIZE
    txt.Center = true
    txt.Outline = true
    txt.OutlineColor = Color3.fromRGB(0,0,0)
    txt.Font = 2
    txt.Visible = false
    espDrawings[plr] = {text = txt}
end

local function getToolsText(plr)
    local tools = {}

    if plr.Character then
        local eq = plr.Character:FindFirstChildOfClass("Tool")
        if eq and not hidden[string.lower(eq.Name)] then table.insert(tools, eq.Name) end
    end

    local bp = plr:FindFirstChild("Backpack")
    if bp then
        for _, t in ipairs(bp:GetChildren()) do
            if t:IsA("Tool") and not hidden[string.lower(t.Name)] then
                table.insert(tools, t.Name)
            end
        end
    end

    if #tools == 0 then return nil end

    local hasSpecial = false
    for _, name in ipairs(tools) do
        if special[string.lower(name)] then hasSpecial = true break end
    end

    local color = hasSpecial and Color3.fromRGB(255, 50, 50) or Color3.fromRGB(230,230,230)

    if #tools <= 5 then
        return table.concat(tools, ", "), color
    else
        local short = {}
        for i=1,4 do table.insert(short, tools[i]) end
        table.insert(short, tools[5].." | +"..(#tools-4).." MÃ¡s")
        return table.concat(short, ", "), color
    end
end

-- LOOP PRINCIPAL
RunService.Heartbeat:Connect(function()
    if not ToolsESP_Enabled then
        for _, obj in pairs(espDrawings) do
            if obj.text then obj.text.Visible = false end
        end
        return
    end

    for plr, obj in pairs(espDrawings) do
        local line, color = getToolsText(plr)
        if not line or not plr.Character or not plr.Character:FindFirstChild("Head") then
            obj.text.Visible = false
            continue
        end

        local headPos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(plr.Character.Head.Position + Vector3.new(0,3.6,0))
        if not onScreen then
            obj.text.Visible = false
            continue
        end

        local size = TEXT_SIZE
        local bounds = TextService:GetTextSize(line, size, Enum.Font.GothamBold, Vector2.new(99999,50))
        while bounds.X > MAX_WIDTH and size > 11 do
            size = size - 0.5
            bounds = TextService:GetTextSize(line, size, Enum.Font.GothamBold, Vector2.new(99999,50))
        end

        obj.text.Size = size
        obj.text.Text = line
        obj.text.Color = color
        obj.text.Position = Vector2.new(headPos.X, headPos.Y)
        obj.text.Visible = true
    end
end)

-- LIMPIEZA
Players.PlayerRemoving:Connect(function(plr)
    if espDrawings[plr] then
        espDrawings[plr].text:Remove()
        espDrawings[plr] = nil
    end
end)

local function setupPlayer(plr)
    if plr == LocalPlayer then return end
    createESP(plr)
end

for _, p in Players:GetPlayers() do setupPlayer(p) end
Players.PlayerAdded:Connect(setupPlayer)

-- TOGGLE
sector15:AddToggle("ESP Guns", false, function(state)
    ToolsESP_Enabled = state
    if not state then
        for _, obj in pairs(espDrawings) do
            if obj.text then obj.text.Visible = false end
        end
    end
end)

-- Anti AFK (evita kick por inactividad)
sector21:AddToggle("Anti-AFK", false, function(state)
    if state then
        game:GetService("Players").LocalPlayer.Idled:Connect(function()
            game:GetService("VirtualUser"):ClickButton2(Vector2.new())
        end)
        warn("Anti AFK Activado")
    end
end)

-- Infinite Yield Admin Commands (FE)
sector21:AddButton("Infinite Yield", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()
end)

-- FE Respawn Button (mata y respawnea instantÃ¡neo)
sector21:AddButton("FE Respawn", function()
    local lp = game.Players.LocalPlayer
    if lp.Character and lp.Character:FindFirstChild("Humanoid") then
        lp.Character.Humanoid.Health = 0
    end
end)

-- Enable Reset Button (activa el botÃ³n de reset aunque estÃ© desactivado)
sector21:AddButton("Enable Reset", function()
    game:GetService("StarterGui"):SetCore("ResetButtonCallback", true)
end)

-- ==================== FULLBRIGHT FE REAL (COMO INFINITE YIELD - MÃXIMA CALIDAD) ====================
local Lighting = game:GetService("Lighting")
local OldLighting = {
    Brightness = Lighting.Brightness,
    GlobalShadows = Lighting.GlobalShadows,
    FogEnd = Lighting.FogEnd,
    FogStart = Lighting.FogStart,
    ClockTime = Lighting.ClockTime,
    Ambient = Lighting.Ambient,
    OutdoorAmbient = Lighting.OutdoorAmbient
}

sector21:AddToggle("Fullbright", false, function(state)
    if state then
        Lighting.Brightness = 3
        Lighting.GlobalShadows = false
        Lighting.FogEnd = 100000
        Lighting.FogStart = 0
        Lighting.ClockTime = 12
        Lighting.Ambient = Color3.fromRGB(255, 255, 255)
        Lighting.OutdoorAmbient = Color3.fromRGB(255, 255, 255)

        -- Elimina todo tipo de oscuridad en tiempo real (FE)
        for _, v in pairs(Lighting:GetChildren()) do
            if v:IsA("BloomEffect") or v:IsA("ColorCorrectionEffect") or v:IsA("SunRaysEffect") or v:IsA("Atmosphere") then
                v.Enabled = false
            end
        end

        -- Reaplica cada vez que aparezca un efecto nuevo
        Lighting.ChildAdded:Connect(function(child)
            if state and (child:IsA("BloomEffect") or child:IsA("ColorCorrectionEffect") or child:IsA("SunRaysEffect") or child:IsA("Atmosphere")) then
                child.Enabled = false
            end
        end)

    else
        -- Restaurar valores originales
        Lighting.Brightness = OldLighting.Brightness
        Lighting.GlobalShadows = OldLighting.GlobalShadows
        Lighting.FogEnd = OldLighting.FogEnd
        Lighting.FogStart = OldLighting.FogStart
        Lighting.ClockTime = OldLighting.ClockTime
        Lighting.Ambient = OldLighting.Ambient
        Lighting.OutdoorAmbient = OldLighting.OutdoorAmbient

        -- Reactivar efectos que estaban antes
        for _, v in pairs(Lighting:GetChildren()) do
            if v:IsA("BloomEffect") or v:IsA("ColorCorrectionEffect") or v:IsA("SunRaysEffect") then
                v.Enabled = true
            end
        end
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- PLAYER ALARM (Bank Alarm) - AÃ‘ADIR EN EL TAB3 â†’ sector20
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

getgenv().PlayerAlarm_Enabled = false
getgenv().PlayerAlarm_Radius = 15         -- Radio por defecto
local SOUND_ID = "rbxassetid://7594301531"
local REPEAT_INTERVAL = 5

local activeAlarmSounds = {}  -- [player.UserId] = {sound = Sound, lastPlayed = tick()}

local function createAlarmSound(parent)
    local sound = Instance.new("Sound")
    sound.SoundId = SOUND_ID
    sound.Volume = 2
    sound.Looped = false
    sound.Parent = parent
    return sound
end

local AlarmConnection
local function startPlayerAlarm()
    if AlarmConnection then return end
    
    AlarmConnection = RunService.Heartbeat:Connect(function()
        if not getgenv().PlayerAlarm_Enabled then return end
        if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("Head") then return end
        
        local myHead = LocalPlayer.Character.Head
        
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local hrp = player.Character.HumanoidRootPart
                local distance = (myHead.Position - hrp.Position).Magnitude
                local uid = player.UserId
                
                if distance <= getgenv().PlayerAlarm_Radius then
                    -- Dentro del rango
                    if not activeAlarmSounds[uid] then
                        local targetHead = player.Character:FindFirstChild("Head") or hrp
                        local sound = createAlarmSound(targetHead)
                        activeAlarmSounds[uid] = {sound = sound, lastPlayed = 0}
                        sound:Play()
                        print("ğŸš¨ [BANK ALARM] Activado para " .. player.Name)
                    end
                    
                    local data = activeAlarmSounds[uid]
                    if tick() - data.lastPlayed >= REPEAT_INTERVAL then
                        data.sound:Play()
                        data.lastPlayed = tick()
                    end
                else
                    -- Fuera del rango
                    if activeAlarmSounds[uid] then
                        activeAlarmSounds[uid].sound:Stop()
                        activeAlarmSounds[uid].sound:Destroy()
                        activeAlarmSounds[uid] = nil
                    end
                end
            else
                -- Jugador muerto o sin personaje
                if activeAlarmSounds[player.UserId] then
                    activeAlarmSounds[player.UserId].sound:Stop()
                    activeAlarmSounds[player.UserId].sound:Destroy()
                    activeAlarmSounds[player.UserId] = nil
                end
            end
        end
    end)
end

local function stopPlayerAlarm()
    if AlarmConnection then
        AlarmConnection:Disconnect()
        AlarmConnection = nil
    end
    for _, data in pairs(activeAlarmSounds) do
        if data.sound then
            data.sound:Stop()
            data.sound:Destroy()
        end
    end
    activeAlarmSounds = {}
end

-- LIMPIAR AL SALIR UN JUGADOR
Players.PlayerRemoving:Connect(function(plr)
    if activeAlarmSounds[plr.UserId] then
        activeAlarmSounds[plr.UserId].sound:Destroy()
        activeAlarmSounds[plr.UserId] = nil
    end
end)

-- TOGGLE + SLIDER (AÃ‘ADE ESTO EN TU sector20)
sector20:AddToggle("Player Alarm", false, function(state)
    getgenv().PlayerAlarm_Enabled = state
    if state then
        startPlayerAlarm()
        print("ğŸš¨ Player Alarm ACTIVADO - Radio: " .. getgenv().PlayerAlarm_Radius .. " studs")
    else
        stopPlayerAlarm()
        print("ğŸš¨ Player Alarm DESACTIVADO")
    end
end)

sector20:AddSlider("Alarm Radius", 15, 1, 50, 1, function(value)
    getgenv().PlayerAlarm_Radius = value
end)
